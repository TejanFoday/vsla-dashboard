<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>VSLA Dashboard - Gender Analysis</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
body{margin:0;padding:20px;background:#f0f0f0;font-family:Arial,sans-serif}
.header{background:linear-gradient(135deg,#00B0F0 0%,#0080C0 100%);color:white;padding:30px;text-align:center;border-radius:10px;margin-bottom:20px}
.header h1{margin:0 0 10px 0;font-size:2.5em}
.gender-filter{background:white;padding:20px;border-radius:8px;margin-bottom:20px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.gender-filter h3{margin:0 0 15px 0;color:#333}
.filter-btn{padding:12px 30px;margin:0 10px;border:2px solid #ddd;background:white;border-radius:25px;cursor:pointer;font-size:16px;font-weight:600;transition:all 0.3s}
.filter-btn:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.2)}
.filter-btn.active{border-color:#00B0F0;background:#00B0F0;color:white;transform:scale(1.05)}
.filter-btn.female.active{border-color:#C65BCF;background:#C65BCF}
.filter-btn.male.active{border-color:#4169E1;background:#4169E1}
.stats{display:flex;gap:15px;margin-bottom:20px;flex-wrap:wrap}
.stat{background:white;padding:20px;border-radius:8px;flex:1;min-width:150px;text-align:center;box-shadow:0 2px 5px rgba(0,0,0,0.1)}
.stat h3{margin:0;font-size:14px;color:#666}
.stat .num{font-size:32px;font-weight:bold;margin:10px 0}
.stat .num.female{color:#C65BCF}
.stat .num.male{color:#4169E1}
.stat .num.all{color:#00B0F0}
.tabs{background:white;display:flex;border-radius:8px;overflow:hidden;margin-bottom:20px;flex-wrap:wrap}
.tab{padding:15px 30px;background:#eee;border:none;cursor:pointer;font-size:16px;flex:1;min-width:120px}
.tab.active{background:#00B0F0;color:white}
.content{display:none;background:white;padding:20px;border-radius:8px}
.content.active{display:block}

/* NEW: Two-column chart layout */
.chart-row{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin:20px 0}
.chart-full{margin:20px 0}
.chart{padding:20px;background:#f9f9f9;border-radius:8px;border:1px solid #e0e0e0}
.chart-title-box{background:#fff;padding:12px 15px;border-left:4px solid #00B0F0;margin-bottom:15px;border-radius:4px}
.chart-title-box h4{margin:0;color:#333;font-size:1.05em}

#map{height:500px;border-radius:8px;margin:20px 0;border:2px solid #C65BCF}
.info{background:#fff0f5;padding:15px;border-left:4px solid #C65BCF;margin:20px 0;border-radius:5px}
h2{color:#00B0F0;border-bottom:2px solid #00B0F0;padding-bottom:10px;margin-bottom:20px}
.filter-indicator{display:inline-block;padding:5px 15px;border-radius:15px;margin-left:10px;font-size:14px}
.filter-indicator.female{background:#FFE4F0;color:#C65BCF;border:1px solid #C65BCF}
.filter-indicator.male{background:#E7F3FF;color:#4169E1;border:1px solid #4169E1}
.filter-indicator.all{background:#E7F9FF;color:#00B0F0;border:1px solid #00B0F0}

/* Responsive: stack on mobile */
@media (max-width: 768px) {
    .chart-row{grid-template-columns:1fr}
}
</style>
</head>
<body>

<div class="header">
<h1>üìä VSLA Impact Dashboard</h1>
<p style="font-size:1.3em;font-weight:600">Gender-Responsive Analysis Tool</p>
<p>Governance ‚Ä¢ Gender Equality ‚Ä¢ Food Security | Sierra Leone</p>
<p style="font-size:0.95em;margin-top:10px">610 Respondents Across 8 Districts</p>
</div>

<div class="gender-filter">
<h3>üéØ Filter Data by Gender:</h3>
<button class="filter-btn female active" id="btn-female" onclick="setFilter('female')">üë© Female (513)</button>
<button class="filter-btn all" id="btn-all" onclick="setFilter('all')">üë• All (610)</button>
<button class="filter-btn male" id="btn-male" onclick="setFilter('male')">üë® Male (97)</button>
<p style="margin-top:15px;color:#666;font-size:14px">Click buttons to update all charts ‚Ä¢ Percentages shown automatically</p>
</div>

<div class="stats">
<div class="stat"><h3>Current View</h3><div class="num female" id="stat-current">513</div><small id="stat-label">Female</small></div>
<div class="stat"><h3>Total</h3><div class="num" style="color:#666">610</div></div>
<div class="stat"><h3>Female</h3><div class="num female">513</div><small>84.1%</small></div>
<div class="stat"><h3>Male</h3><div class="num male">97</div><small>15.9%</small></div>
<div class="stat"><h3>Districts</h3><div class="num" style="color:#00B0F0">8</div></div>
<div class="stat"><h3>Governance</h3><div class="num" style="font-size:24px" id="stat-gov">184</div><small>respondents</small></div>
<div class="stat"><h3>Gender Eq.</h3><div class="num" style="font-size:24px" id="stat-gender">183</div><small>respondents</small></div>
<div class="stat"><h3>Food Sec.</h3><div class="num" style="font-size:24px" id="stat-food">146</div><small>respondents</small></div>
</div>

<div class="tabs">
<button class="tab active" onclick="showTab(0)">üìà Overview</button>
<button class="tab" onclick="showTab(1)">üèõÔ∏è Governance</button>
<button class="tab" onclick="showTab(2)">‚öñÔ∏è Gender Equality</button>
<button class="tab" onclick="showTab(3)">üåæ Food Security</button>
<button class="tab" onclick="showTab(4)">üí° Insights</button>
</div>

<div id="tab0" class="content active">
<h2>Data Collection Sites <span class="filter-indicator female" id="ind-overview">Female</span></h2>
<div class="info">
<strong>üó∫Ô∏è Map shows all 8 data collection districts.</strong> Use gender filter above to see how responses differ. All bar charts display percentages for easy comparison.
</div>
<div id="map"></div>

<div class="chart-full">
<div class="chart"><div class="chart-title-box"><h4>Respondents by District</h4></div><div id="chart-district"></div></div>
</div>

<div class="chart-row">
<div class="chart"><div class="chart-title-box"><h4>Distribution by Survey Type</h4></div><div id="chart-survey"></div></div>
<div class="chart"><div class="chart-title-box"><h4>VSLA Membership Status</h4></div><div id="chart-vsla"></div></div>
</div>
</div>

<div id="tab1" class="content">
<h2>Governance & Civic Participation <span class="filter-indicator female" id="ind-gov">Female</span></h2>
<div class="info">Community governance, VSLA participation, and civic engagement patterns</div>

<div class="chart-row">
<div class="chart"><div class="chart-title-box" id="title-gov-1"><h4>Chart 1</h4></div><div id="gov-1"></div></div>
<div class="chart"><div class="chart-title-box" id="title-gov-2"><h4>Chart 2</h4></div><div id="gov-2"></div></div>
</div>

<div class="chart-row">
<div class="chart"><div class="chart-title-box" id="title-gov-3"><h4>Chart 3</h4></div><div id="gov-3"></div></div>
<div class="chart"><div class="chart-title-box" id="title-gov-4"><h4>Chart 4</h4></div><div id="gov-4"></div></div>
</div>

<div class="chart-row">
<div class="chart"><div class="chart-title-box" id="title-gov-5"><h4>Chart 5</h4></div><div id="gov-5"></div></div>
<div class="chart"><div class="chart-title-box" id="title-gov-6"><h4>Chart 6</h4></div><div id="gov-6"></div></div>
</div>

<div class="chart-row">
<div class="chart"><div class="chart-title-box" id="title-gov-7"><h4>Chart 7</h4></div><div id="gov-7"></div></div>
<div class="chart"><div class="chart-title-box" id="title-gov-8"><h4>Chart 8</h4></div><div id="gov-8"></div></div>
</div>
</div>

<div id="tab2" class="content">
<h2>Gender Equality & Empowerment <span class="filter-indicator female" id="ind-gender">Female</span></h2>
<div class="info">Household roles, economic empowerment, and gender equality indicators</div>

<div class="chart-row">
<div class="chart"><div class="chart-title-box" id="title-gender-1"><h4>Chart 1</h4></div><div id="gender-1"></div></div>
<div class="chart"><div class="chart-title-box" id="title-gender-2"><h4>Chart 2</h4></div><div id="gender-2"></div></div>
</div>

<div class="chart-row">
<div class="chart"><div class="chart-title-box" id="title-gender-3"><h4>Chart 3</h4></div><div id="gender-3"></div></div>
<div class="chart"><div class="chart-title-box" id="title-gender-4"><h4>Chart 4</h4></div><div id="gender-4"></div></div>
</div>

<div class="chart-row">
<div class="chart"><div class="chart-title-box" id="title-gender-5"><h4>Chart 5</h4></div><div id="gender-5"></div></div>
<div class="chart"><div class="chart-title-box" id="title-gender-6"><h4>Chart 6</h4></div><div id="gender-6"></div></div>
</div>

<div class="chart-row">
<div class="chart"><div class="chart-title-box" id="title-gender-7"><h4>Chart 7</h4></div><div id="gender-7"></div></div>
<div class="chart"><div class="chart-title-box" id="title-gender-8"><h4>Chart 8</h4></div><div id="gender-8"></div></div>
</div>

<div class="chart-row">
<div class="chart"><div class="chart-title-box" id="title-gender-9"><h4>Chart 9</h4></div><div id="gender-9"></div></div>
<div class="chart"><div class="chart-title-box" id="title-gender-10"><h4>Chart 10</h4></div><div id="gender-10"></div></div>
</div>
</div>

<div id="tab3" class="content">
<h2>Food Security & Nutrition <span class="filter-indicator female" id="ind-food">Female</span></h2>
<div class="info">Food access, nutrition patterns, and household food security status</div>

<div class="chart-row">
<div class="chart"><div class="chart-title-box" id="title-food-1"><h4>Chart 1</h4></div><div id="food-1"></div></div>
<div class="chart"><div class="chart-title-box" id="title-food-2"><h4>Chart 2</h4></div><div id="food-2"></div></div>
</div>

<div class="chart-row">
<div class="chart"><div class="chart-title-box" id="title-food-3"><h4>Chart 3</h4></div><div id="food-3"></div></div>
<div class="chart"><div class="chart-title-box" id="title-food-4"><h4>Chart 4</h4></div><div id="food-4"></div></div>
</div>

<div class="chart-row">
<div class="chart"><div class="chart-title-box" id="title-food-5"><h4>Chart 5</h4></div><div id="food-5"></div></div>
<div class="chart"><div class="chart-title-box" id="title-food-6"><h4>Chart 6</h4></div><div id="food-6"></div></div>
</div>

<div class="chart-row">
<div class="chart"><div class="chart-title-box" id="title-food-7"><h4>Chart 7</h4></div><div id="food-7"></div></div>
<div class="chart"><div class="chart-title-box" id="title-food-8"><h4>Chart 8</h4></div><div id="food-8"></div></div>
</div>

<div class="chart-row">
<div class="chart"><div class="chart-title-box" id="title-food-9"><h4>Chart 9</h4></div><div id="food-9"></div></div>
<div class="chart"><div class="chart-title-box" id="title-food-10"><h4>Chart 10</h4></div><div id="food-10"></div></div>
</div>
</div>

<div id="tab4" class="content">
<h2>Key Insights <span class="filter-indicator female" id="ind-insights">Female</span></h2>
<div class="info" style="background:#e7f3ff;border-color:#00B0F0">
<h3 style="color:#00B0F0">üí° Gender-Responsive Analysis</h3>
<p>All charts display percentages for easy comparison. Switch between Female, Male, and All views to identify patterns and gaps. Charts are arranged in pairs for efficient comparison.</p>
</div>
<div class="info" style="background:#e7f3ff;border-color:#00B0F0">
<h3 style="color:#00B0F0">Strong VSLA Participation</h3>
<p>Women comprise 84.1% of respondents, reflecting VSLA's focus on female empowerment across Sierra Leone.</p>
</div>
<div class="info" style="background:#e7f3ff;border-color:#00B0F0">
<h3 style="color:#00B0F0">Geographic Coverage</h3>
<p>Data collected from 8 districts with varying participation rates. Each chart shows percentage distribution for better comparison across gender groups.</p>
</div>
<div class="info" style="background:#e7f3ff;border-color:#00B0F0">
<h3 style="color:#00B0F0">How to Use This Dashboard</h3>
<p><strong>Compare across genders:</strong> Use the filter buttons at the top to switch views.<br>
<strong>Read percentages:</strong> All bar charts show % for easy comparison.<br>
<strong>Efficient layout:</strong> Charts are paired side-by-side for quick scanning.</p>
</div>
</div>

<script>
const DATA = {"stats": {"total": 610, "female": 513, "male": 97, "gov_female": 184, "gov_male": 18, "gender_female": 183, "gender_male": 25, "food_female": 146, "food_male": 54}, "charts": {"district": {"title": "Respondents by District", "question": "District", "female": {"labels": ["Kono", "Pujehun", "Bo", "Port Loko", "Bonthe", "Bombali", "Tonkolili", "Kenema"], "values": [137, 103, 69, 61, 41, 38, 37, 27], "percentages": [26.7, 20.1, 13.5, 11.9, 8.0, 7.4, 7.2, 5.3], "total": 513}, "male": {"labels": ["Pujehun", "Kono", "Port Loko", "Bonthe", "Bombali", "Bo", "Kenema"], "values": [40, 18, 15, 10, 6, 6, 2], "percentages": [41.2, 18.6, 15.5, 10.3, 6.2, 6.2, 2.1], "total": 97}, "all": {"labels": ["Kono", "Pujehun", "Port Loko", "Bo", "Bonthe", "Bombali", "Tonkolili", "Kenema"], "values": [155, 143, 76, 75, 51, 44, 37, 29], "percentages": [25.4, 23.4, 12.5, 12.3, 8.4, 7.2, 6.1, 4.8], "total": 610}}, "gov-1": {"female": {"labels": ["Yes"], "values": [184], "percentages": [100.0], "total": 184}, "male": {"labels": ["Yes"], "values": [18], "percentages": [100.0], "total": 18}, "all": {"labels": ["Yes"], "values": [202], "percentages": [100.0], "total": 202}, "title": "VSLA Membership Status", "question": "Are you a member of a VSLA?"}, "gov-2": {"female": {"labels": ["1.0", "2.0", "3.0", "4.0", "5.0", "6.0", "7.0", "8.0"], "values": [29, 66, 58, 8, 8, 5, 2, 3], "percentages": [16.2, 36.9, 32.4, 4.5, 4.5, 2.8, 1.1, 1.7], "total": 179}, "male": {"labels": ["1.0", "2.0", "3.0"], "values": [3, 10, 5], "percentages": [16.7, 55.6, 27.8], "total": 18}, "all": {"labels": ["1.0", "2.0", "3.0", "4.0", "5.0", "6.0", "7.0", "8.0"], "values": [32, 76, 63, 8, 8, 5, 2, 3], "percentages": [16.2, 38.6, 32.0, 4.1, 4.1, 2.5, 1.0, 1.5], "total": 197}, "title": "Duration of VSLA Membership (Years)", "question": "If yes, how long have you been a VSLA member (years)?"}, "gov-3": {"female": {"labels": ["Mixed", "Women exclusive"], "values": [111, 73], "percentages": [60.3, 39.7], "total": 184}, "male": {"labels": ["Mixed"], "values": [18], "percentages": [100.0], "total": 18}, "all": {"labels": ["Mixed", "Women exclusive"], "values": [129, 73], "percentages": [63.9, 36.1], "total": 202}, "title": "Type of VSLA Participated", "question": "What type of VSLA did you participate in?"}, "gov-4": {"female": {"labels": ["Ordinary member", "Others (Specify)", "Committee member", "Secretary", "Treasurer", "Chairperson"], "values": [117, 21, 14, 13, 13, 5], "percentages": [63.9, 11.5, 7.7, 7.1, 7.1, 2.7], "total": 183}, "male": {"labels": ["Ordinary member", "Secretary", "Others (Specify)", "Treasurer", "Chairperson", "Committee member"], "values": [8, 4, 3, 1, 1, 1], "percentages": [44.4, 22.2, 16.7, 5.6, 5.6, 5.6], "total": 18}, "all": {"labels": ["Ordinary member", "Others (Specify)", "Secretary", "Committee member", "Treasurer", "Chairperson"], "values": [125, 24, 17, 15, 14, 6], "percentages": [62.2, 11.9, 8.5, 7.5, 7.0, 3.0], "total": 201}, "title": "Role in VSLA Group", "question": "Your role in the VSLA"}, "gov-5": {"female": {"labels": [], "values": [], "percentages": [], "total": 0}, "male": {"labels": [], "values": [], "percentages": [], "total": 0}, "all": {"labels": [], "values": [], "percentages": [], "total": 0}, "title": "Confidence Sharing Views in Community Meetings", "question": "HelIo, I am working with a team to conduct VSLA study. We are conducting this exercise with community members to understand the role of VSLAs to individual members, groups and communities. You have been selected for participation in an interview and so I would highly appreciate if you agreed to participate in this study. Your participation is voluntary. Any information you share with me will be kept absolutely confidential and no one other than the concerned people will have access to this information. My interview with you will take about 20 minutes and there is no financial compensation for your participation. We hope that you will participate in this study, as your opinions and experiences are very important to us. Do you consent to participate and to audio / note-taking?"}, "gov-6": {"female": {"labels": ["Yes", "No"], "values": [169, 14], "percentages": [92.3, 7.7], "total": 183}, "male": {"labels": ["Yes", "No"], "values": [17, 1], "percentages": [94.4, 5.6], "total": 18}, "all": {"labels": ["Yes", "No"], "values": [186, 15], "percentages": [92.5, 7.5], "total": 201}, "title": "Invited to Participate in Community Planning", "question": "Have you been invited to participate in any community planning or development activities (e.g., ward development planning)?"}, "gov-7": {"female": {"labels": ["Always", "Sometimes", "Often", "Never"], "values": [122, 48, 9, 4], "percentages": [66.7, 26.2, 4.9, 2.2], "total": 183}, "male": {"labels": ["Always", "Sometimes", "Never"], "values": [13, 3, 2], "percentages": [72.2, 16.7, 11.1], "total": 18}, "all": {"labels": ["Always", "Sometimes", "Often", "Never"], "values": [135, 51, 9, 6], "percentages": [67.2, 25.4, 4.5, 3.0], "total": 201}, "title": "Contribution Considered in Community Decisions", "question": "Do you think your contribution is considered when community decisions are made?"}, "gov-8": {"female": {"labels": ["Yes", "No"], "values": [121, 62], "percentages": [66.1, 33.9], "total": 183}, "male": {"labels": ["Yes", "No"], "values": [17, 1], "percentages": [94.4, 5.6], "total": 18}, "all": {"labels": ["Yes", "No"], "values": [138, 63], "percentages": [68.7, 31.3], "total": 201}, "title": "Held Leadership Position in VSLA", "question": "Have you ever held a leadership position in your VSLA?"}, "gender-1": {"female": {"labels": ["Dependent", "Household Head"], "values": [137, 46], "percentages": [74.9, 25.1], "total": 183}, "male": {"labels": ["Household Head", "Dependent"], "values": [23, 2], "percentages": [92.0, 8.0], "total": 25}, "all": {"labels": ["Dependent", "Household Head"], "values": [139, 69], "percentages": [66.8, 33.2], "total": 208}, "title": "Role in the Household", "question": "Role in the Household"}, "gender-2": {"female": {"labels": ["No formal education", "Primary", "JSS", "SSS", "Non-formal", "Tertiary"], "values": [92, 35, 26, 15, 11, 4], "percentages": [50.3, 19.1, 14.2, 8.2, 6.0, 2.2], "total": 183}, "male": {"labels": ["No formal education", "Primary", "Tertiary", "Non-formal", "JSS"], "values": [9, 5, 5, 4, 2], "percentages": [36.0, 20.0, 20.0, 16.0, 8.0], "total": 25}, "all": {"labels": ["No formal education", "Primary", "JSS", "SSS", "Non-formal", "Tertiary"], "values": [101, 40, 28, 15, 15, 9], "percentages": [48.6, 19.2, 13.5, 7.2, 7.2, 4.3], "total": 208}, "title": "Educational Attainment Level", "question": "What is your educational attainment?"}, "gender-3": {"female": {"labels": ["Crop production", "Petty trading", "Others (Specify)"], "values": [99, 82, 2], "percentages": [54.1, 44.8, 1.1], "total": 183}, "male": {"labels": ["Crop production", "Petty trading", "Others (Specify)"], "values": [17, 6, 2], "percentages": [68.0, 24.0, 8.0], "total": 25}, "all": {"labels": ["Crop production", "Petty trading", "Others (Specify)"], "values": [116, 88, 4], "percentages": [55.8, 42.3, 1.9], "total": 208}, "title": "Main Source of Household Income", "question": "What is your household's main source of income/livelihood activity?"}, "gender-4": {"female": {"labels": ["Yes"], "values": [183], "percentages": [100.0], "total": 183}, "male": {"labels": ["Yes"], "values": [25], "percentages": [100.0], "total": 25}, "all": {"labels": ["Yes"], "values": [208], "percentages": [100.0], "total": 208}, "title": "VSLA Membership Status", "question": "Are you a member of a VSLA?"}, "gender-5": {"female": {"labels": ["Self", "Spouse", "Joint"], "values": [76, 75, 32], "percentages": [41.5, 41.0, 17.5], "total": 183}, "male": {"labels": ["Self", "Joint", "Spouse"], "values": [19, 4, 2], "percentages": [76.0, 16.0, 8.0], "total": 25}, "all": {"labels": ["Self", "Spouse", "Joint"], "values": [95, 77, 36], "percentages": [45.7, 37.0, 17.3], "total": 208}, "title": "Control Over Household Income", "question": "Who has control over household income?"}, "gender-6": {"female": {"labels": ["Mixed", "Women exclusive", "Others (Specify)"], "values": [103, 78, 2], "percentages": [56.3, 42.6, 1.1], "total": 183}, "male": {"labels": ["Mixed"], "values": [25], "percentages": [100.0], "total": 25}, "all": {"labels": ["Mixed", "Women exclusive", "Others (Specify)"], "values": [128, 78, 2], "percentages": [61.5, 37.5, 1.0], "total": 208}, "title": "Type of VSLA Participated", "question": "What type of VSLA did you participate in?"}, "gender-7": {"female": {"labels": ["Ordinary member", "Others (Specify)", "Committee member", "Treasurer", "Secretary", "Chairperson"], "values": [125, 24, 16, 9, 4, 4], "percentages": [68.7, 13.2, 8.8, 4.9, 2.2, 2.2], "total": 182}, "male": {"labels": ["Ordinary member", "Treasurer", "Others (Specify)", "Secretary", "Chairperson"], "values": [14, 4, 3, 2, 1], "percentages": [58.3, 16.7, 12.5, 8.3, 4.2], "total": 24}, "all": {"labels": ["Ordinary member", "Others (Specify)", "Committee member", "Treasurer", "Secretary", "Chairperson"], "values": [139, 27, 16, 13, 6, 5], "percentages": [67.5, 13.1, 7.8, 6.3, 2.9, 2.4], "total": 206}, "title": "Role in VSLA Group", "question": "Your role in the VSLA"}, "gender-8": {"female": {"labels": ["1.0", "2.0", "3.0", "4.0", "5.0", "6.0", "7.0", "8.0"], "values": [39, 63, 52, 7, 10, 7, 1, 1], "percentages": [21.7, 35.0, 28.9, 3.9, 5.6, 3.9, 0.6, 0.6], "total": 180}, "male": {"labels": ["1.0", "2.0", "3.0", "4.0", "5.0", "11.0"], "values": [5, 5, 10, 2, 2, 1], "percentages": [20.0, 20.0, 40.0, 8.0, 8.0, 4.0], "total": 25}, "all": {"labels": ["1.0", "2.0", "3.0", "4.0", "5.0", "6.0", "7.0", "11.0"], "values": [44, 68, 62, 9, 12, 7, 1, 2], "percentages": [21.5, 33.2, 30.2, 4.4, 5.9, 3.4, 0.5, 1.0], "total": 205}, "title": "Duration of VSLA Membership (Years)", "question": "If yes, how long have you been a VSLA member (years)?"}, "gender-9": {"female": {"labels": ["Married", "Widowed", "Single", "Divorced", "Co-habit"], "values": [145, 19, 10, 5, 4], "percentages": [79.2, 10.4, 5.5, 2.7, 2.2], "total": 183}, "male": {"labels": ["Married", "Single", "Widowed"], "values": [22, 2, 1], "percentages": [88.0, 8.0, 4.0], "total": 25}, "all": {"labels": ["Married", "Widowed", "Single", "Divorced", "Co-habit"], "values": [167, 20, 12, 5, 4], "percentages": [80.3, 9.6, 5.8, 2.4, 1.9], "total": 208}, "title": "Marital Status", "question": "Marital status"}, "gender-10": {"title": "Household Composition (Number of People)", "question": "Household composition", "female": {"labels": ["1-3", "4-5", "6-7", "8-10", "10+"], "values": [5, 48, 62, 53, 15], "percentages": [2.7, 26.2, 33.9, 29.0, 8.2], "total": 183}, "male": {"labels": ["1-3", "4-5", "6-7", "8-10", "10+"], "values": [1, 2, 5, 9, 8], "percentages": [4.0, 8.0, 20.0, 36.0, 32.0], "total": 25}, "all": {"labels": ["1-3", "4-5", "6-7", "8-10", "10+"], "values": [6, 50, 67, 62, 23], "percentages": [2.9, 24.0, 32.2, 29.8, 11.1], "total": 208}}, "food-1": {"female": {"labels": ["2 meals", "3 meals", "1 meal", "More than 3 meals"], "values": [91, 47, 7, 1], "percentages": [62.3, 32.2, 4.8, 0.7], "total": 146}, "male": {"labels": ["2 meals", "3 meals", "1 meal"], "values": [37, 14, 3], "percentages": [68.5, 25.9, 5.6], "total": 54}, "all": {"labels": ["2 meals", "3 meals", "1 meal", "More than 3 meals"], "values": [128, 61, 10, 1], "percentages": [64.0, 30.5, 5.0, 0.5], "total": 200}, "title": "Number of Meals Eaten Daily", "question": "How many meals does your household eat daily?"}, "food-2": {"female": {"labels": ["Yes", "No"], "values": [98, 48], "percentages": [67.1, 32.9], "total": 146}, "male": {"labels": ["Yes", "No"], "values": [32, 22], "percentages": [59.3, 40.7], "total": 54}, "all": {"labels": ["Yes", "No"], "values": [130, 70], "percentages": [65.0, 35.0], "total": 200}, "title": "Experience of Food Shortage in Last 12 Months", "question": "In the last 12 months, did you experience food shortage?"}, "food-3": {"female": {"labels": ["Sometimes", "Never", "Rarely", "Very often"], "values": [83, 46, 15, 2], "percentages": [56.8, 31.5, 10.3, 1.4], "total": 146}, "male": {"labels": ["Sometimes", "Never", "Rarely"], "values": [24, 22, 8], "percentages": [44.4, 40.7, 14.8], "total": 54}, "all": {"labels": ["Sometimes", "Never", "Rarely", "Very often"], "values": [107, 68, 23, 2], "percentages": [53.5, 34.0, 11.5, 1.0], "total": 200}, "title": "Frequency of Skipping Meals", "question": "How often does your household skip meals due to lack of food or money?"}, "food-4": {"female": {"labels": ["Yes", "No"], "values": [145, 1], "percentages": [99.3, 0.7], "total": 146}, "male": {"labels": ["Yes"], "values": [54], "percentages": [100.0], "total": 54}, "all": {"labels": ["Yes", "No"], "values": [199, 1], "percentages": [99.5, 0.5], "total": 200}, "title": "VSLA Membership Status", "question": "Are you a member of a VSLA?"}, "food-5": {"female": {"labels": ["Spouse", "Joint", "Self"], "values": [72, 38, 36], "percentages": [49.3, 26.0, 24.7], "total": 146}, "male": {"labels": ["Self", "Joint", "Spouse"], "values": [25, 20, 9], "percentages": [46.3, 37.0, 16.7], "total": 54}, "all": {"labels": ["Spouse", "Self", "Joint"], "values": [81, 61, 58], "percentages": [40.5, 30.5, 29.0], "total": 200}, "title": "Control Over Household Income", "question": "Who has control over household income?"}, "food-6": {"female": {"labels": ["Crop production", "Petty trading", "Others (Specify)", "Transportation"], "values": [122, 18, 5, 1], "percentages": [83.6, 12.3, 3.4, 0.7], "total": 146}, "male": {"labels": ["Crop production", "Petty trading", "Others (Specify)", "Transportation"], "values": [44, 4, 4, 2], "percentages": [81.5, 7.4, 7.4, 3.7], "total": 54}, "all": {"labels": ["Crop production", "Petty trading", "Others (Specify)", "Transportation"], "values": [166, 22, 9, 3], "percentages": [83.0, 11.0, 4.5, 1.5], "total": 200}, "title": "Main Source of Household Income", "question": "What is your household's main source of income/livelihood activity?"}, "food-7": {"female": {"labels": ["Mixed", "Women exclusive"], "values": [125, 20], "percentages": [86.2, 13.8], "total": 145}, "male": {"labels": ["Mixed"], "values": [54], "percentages": [100.0], "total": 54}, "all": {"labels": ["Mixed", "Women exclusive"], "values": [179, 20], "percentages": [89.9, 10.1], "total": 199}, "title": "Type of VSLA Participated", "question": "What type of VSLA did you participate in?"}, "food-8": {"female": {"labels": ["Ordinary member", "Others (Specify)", "Committee member", "Chairperson", "Treasurer", "Secretary"], "values": [93, 18, 10, 10, 9, 2], "percentages": [65.5, 12.7, 7.0, 7.0, 6.3, 1.4], "total": 142}, "male": {"labels": ["Ordinary member", "Secretary", "Others (Specify)", "Chairperson", "Treasurer"], "values": [28, 11, 8, 5, 2], "percentages": [51.9, 20.4, 14.8, 9.3, 3.7], "total": 54}, "all": {"labels": ["Ordinary member", "Others (Specify)", "Chairperson", "Secretary", "Treasurer", "Committee member"], "values": [121, 26, 15, 13, 11, 10], "percentages": [61.7, 13.3, 7.7, 6.6, 5.6, 5.1], "total": 196}, "title": "Role in VSLA Group", "question": "Your role in the VSLA"}, "food-9": {"female": {"labels": ["1.0", "2.0", "3.0", "4.0", "6.0", "7.0", "10.0", "15.0"], "values": [11, 65, 49, 4, 1, 1, 2, 5], "percentages": [8.0, 47.1, 35.5, 2.9, 0.7, 0.7, 1.4, 3.6], "total": 138}, "male": {"labels": ["1.0", "2.0", "3.0", "4.0", "5.0", "6.0", "10.0"], "values": [4, 22, 21, 2, 1, 2, 1], "percentages": [7.5, 41.5, 39.6, 3.8, 1.9, 3.8, 1.9], "total": 53}, "all": {"labels": ["1.0", "2.0", "3.0", "4.0", "6.0", "7.0", "10.0", "15.0"], "values": [15, 87, 70, 6, 3, 1, 3, 5], "percentages": [7.9, 45.8, 36.8, 3.2, 1.6, 0.5, 1.6, 2.6], "total": 190}, "title": "Duration of VSLA Membership (Years)", "question": "If yes, how long have you been a VSLA member (years)?"}, "food-10": {"female": {"labels": ["Yes, greatly", "Yes, somewhat", "No change"], "values": [94, 45, 6], "percentages": [64.8, 31.0, 4.1], "total": 145}, "male": {"labels": ["Yes, greatly", "Yes, somewhat", "No change"], "values": [31, 19, 4], "percentages": [57.4, 35.2, 7.4], "total": 54}, "all": {"labels": ["Yes, greatly", "Yes, somewhat", "No change"], "values": [125, 64, 10], "percentages": [62.8, 32.2, 5.0], "total": 199}, "title": "Impact of VSLA on Ability to Buy Nutritious Foods", "question": "Since joining the VSLA, has your ability to buy nutritious foods (e.g., vegetables, fruits, protein-rich foods) improved?"}}, "map_markers": [{"name": "Bo", "lat": 7.9647, "lon": -11.7383, "count": 75}, {"name": "Bombali", "lat": 9.0833, "lon": -12.4833, "count": 44}, {"name": "Bonthe", "lat": 7.5264, "lon": -12.5092, "count": 51}, {"name": "Kenema", "lat": 7.8767, "lon": -11.19, "count": 29}, {"name": "Kono", "lat": 8.6408, "lon": -10.8428, "count": 155}, {"name": "Port Loko", "lat": 8.7658, "lon": -12.7875, "count": 76}, {"name": "Pujehun", "lat": 7.3528, "lon": -11.7203, "count": 143}, {"name": "Tonkolili", "lat": 8.65, "lon": -11.7833, "count": 37}]};
let currentFilter = 'female';
let myMap = null;

function showTab(n) {
    document.querySelectorAll('.tab').forEach((t,i) => t.classList.toggle('active', i===n));
    document.querySelectorAll('.content').forEach((c,i) => c.classList.toggle('active', i===n));
}

function setFilter(gender) {
    currentFilter = gender;
    console.log('Filter changed to:', gender);
    
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('btn-' + gender).classList.add('active');
    
    const stats = DATA.stats;
    if (gender === 'female') {
        document.getElementById('stat-current').textContent = stats.female;
        document.getElementById('stat-current').className = 'num female';
        document.getElementById('stat-label').textContent = 'Female';
        document.getElementById('stat-gov').textContent = stats.gov_female;
        document.getElementById('stat-gender').textContent = stats.gender_female;
        document.getElementById('stat-food').textContent = stats.food_female;
    } else if (gender === 'male') {
        document.getElementById('stat-current').textContent = stats.male;
        document.getElementById('stat-current').className = 'num male';
        document.getElementById('stat-label').textContent = 'Male';
        document.getElementById('stat-gov').textContent = stats.gov_male;
        document.getElementById('stat-gender').textContent = stats.gender_male;
        document.getElementById('stat-food').textContent = stats.food_male;
    } else {
        document.getElementById('stat-current').textContent = stats.total;
        document.getElementById('stat-current').className = 'num all';
        document.getElementById('stat-label').textContent = 'All';
        document.getElementById('stat-gov').textContent = stats.gov_female + stats.gov_male;
        document.getElementById('stat-gender').textContent = stats.gender_female + stats.gender_male;
        document.getElementById('stat-food').textContent = stats.food_female + stats.food_male;
    }
    
    const label = gender === 'female' ? 'Female' : gender === 'male' ? 'Male' : 'All';
    ['ind-overview','ind-gov','ind-gender','ind-food','ind-insights'].forEach(id => {
        const el = document.getElementById(id);
        el.textContent = label;
        el.className = 'filter-indicator ' + gender;
    });
    
    updateCharts();
}

function updateCharts() {
    const color = currentFilter === 'female' ? '#C65BCF' : currentFilter === 'male' ? '#4169E1' : '#00B0F0';
    const colors = [color, '#FF69B4', '#DDA0DD', '#4169E1', '#00B0F0', '#FFB6C1'];
    
    // District chart with percentages
    const dist = DATA.charts.district[currentFilter];
    if (dist) {
        const labels = dist.labels.map((l, i) => l + ' (' + dist.percentages[i] + '%)');
        Plotly.newPlot('chart-district', [{
            x: dist.percentages,
            y: labels,
            type: 'bar',
            orientation: 'h',
            marker: {color: color},
            text: dist.percentages.map(p => p + '%'),
            textposition: 'outside',
            hovertemplate: '%{label}<br>%{x}%<extra></extra>'
        }], {
            height: 450,
            xaxis: {title: 'Percentage (%)', range: [0, Math.max(...dist.percentages) * 1.1]},
            yaxis: {title: ''},
            margin: {l: 120, r: 50}
        }, {responsive: true, displayModeBar: false});
    }
    
    // Survey distribution
    const surveyVals = currentFilter === 'female' ? [184,183,146] : 
                       currentFilter === 'male' ? [18,25,54] : [202,208,200];
    
    Plotly.newPlot('chart-survey', [{
        labels: ['Governance','Gender Eq.','Food Sec.'],
        values: surveyVals,
        type: 'pie',
        marker: {colors: colors},
        textinfo: 'label+percent',
        hovertemplate: '%{label}<br>%{value} respondents (%{percent})<extra></extra>'
    }], {height: 350}, {responsive: true, displayModeBar: false});
    
    // VSLA membership
    const vslaVals = currentFilter === 'female' ? [450,63] : 
                     currentFilter === 'male' ? [68,29] : [518,92];
    Plotly.newPlot('chart-vsla', [{
        labels: ['VSLA Member','Not Member'],
        values: vslaVals,
        type: 'pie',
        marker: {colors: colors},
        textinfo: 'label+percent',
        hovertemplate: '%{label}<br>%{value} respondents (%{percent})<extra></extra>'
    }], {height: 350}, {responsive: true, displayModeBar: false});
    
    // Update all other charts
    Object.keys(DATA.charts).forEach(key => {
        if (key !== 'district' && DATA.charts[key][currentFilter]) {
            const chartInfo = DATA.charts[key];
            const chartData = chartInfo[currentFilter];
            
            // Update title
            const titleId = 'title-' + key;
            const titleEl = document.getElementById(titleId);
            if (titleEl && chartInfo.title) {
                titleEl.querySelector('h4').textContent = chartInfo.title;
            }
            
            if (chartData && chartData.labels) {
                const isPie = key.includes('-1') || key.includes('-3') || key.includes('-4') || key.includes('-5') || key.includes('-7');
                const isHoriz = !isPie && chartData.labels.some(l => l.length > 20);
                
                if (isPie && chartData.labels.length <= 8) {
                    Plotly.newPlot(key, [{
                        labels: chartData.labels,
                        values: chartData.values,
                        type: 'pie',
                        marker: {colors: colors},
                        textinfo: 'label+percent',
                        hovertemplate: '%{label}<br>%{value} respondents (%{percent})<extra></extra>'
                    }], {height: 350}, {responsive: true, displayModeBar: false});
                } else {
                    // Bar chart with percentages
                    const pcts = chartData.percentages || chartData.values;
                    const labelsWithPct = chartData.labels.map((l, i) => 
                        l + ' (' + (chartData.percentages ? chartData.percentages[i] : '0') + '%)'
                    );
                    
                    Plotly.newPlot(key, [{
                        x: isHoriz ? pcts : chartData.labels,
                        y: isHoriz ? labelsWithPct : pcts,
                        type: 'bar',
                        orientation: isHoriz ? 'h' : 'v',
                        marker: {color: color},
                        text: pcts.map(p => p + '%'),
                        textposition: isHoriz ? 'outside' : 'outside',
                        hovertemplate: isHoriz ? '%{y}<br>%{x}%<extra></extra>' : '%{x}<br>%{y}%<extra></extra>'
                    }], {
                        height: 350,
                        margin: isHoriz ? {l: 180, r: 50} : {b: 100},
                        xaxis: {title: isHoriz ? 'Percentage (%)' : '', range: isHoriz ? [0, Math.max(...pcts) * 1.1] : null, tickangle: isHoriz ? 0 : -45},
                        yaxis: {title: isHoriz ? '' : 'Percentage (%)'}
                    }, {responsive: true, displayModeBar: false});
                }
            }
        }
    });
}

function initMap() {
    myMap = L.map('map').setView([8.4657, -11.7799], 8);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap'
    }).addTo(myMap);
    
    DATA.map_markers.forEach(marker => {
        L.circleMarker([marker.lat, marker.lon], {
            radius: 10 + marker.count/8,
            fillColor: '#FF69B4',
            color: '#C65BCF',
            weight: 2,
            fillOpacity: 0.7
        }).bindPopup(`<b>${marker.name} District</b><br>${marker.count} total respondents<br><small>Data collection site</small>`).addTo(myMap);
        
        L.marker([marker.lat + 0.15, marker.lon], {
            icon: L.divIcon({
                html: `<div style="background:white;padding:2px 8px;border:1px solid #C65BCF;border-radius:3px;font-weight:bold;color:#C65BCF;white-space:nowrap;font-size:12px">${marker.name} (${marker.count})</div>`,
                className: ''
            })
        }).addTo(myMap);
    });
}

window.addEventListener('load', function() {
    console.log('Initializing dashboard with 2-column layout...');
    initMap();
    updateCharts();
    console.log('Dashboard ready!');
});
</script>
</body>
</html>